version: '3.3'

services:
  return_data:
    build:
      context: .
      dockerfile: Dockerfile
      args:
          - http_proxy=$http_proxy
          - https_proxy=$http_proxy
    container_name: return_data
    env_file:
      - .env
    ports:
      - 8282:80
    volumes:
      - './sources:/app:ro'
    command: "python3 app.py"
    networks:
      - web
    labels:
      - traefik.enable=true
      - traefik.port=80
      # Traefik上のバックエンド名を記載
      - traefik.backend=return_data
      - "traefik.frontend.rule=PathPrefixStrip:/check"
      - "traefik.frontend.redirect.regex=^(.*)/check$$"
      - "traefik.frontend.redirect.replacement=$$1/check/"
      - "traefik.frontend.rule=PathPrefixStrip:/check;ReplacePathRegex: ^/(.*) /$$1"
      - "traefik.docker.network=web"
      - "traefik.frontend.entryPoints=http"
      - "traefik.protocol=http"
    tty: true

networks:
  web:
    external: true

